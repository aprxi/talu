{
  "name": "gemma3",
  "model_types": [
    "gemma3",
    "gemma3_text",
    "gemma2",
    "gemma"
  ],
  "weight_prefixes": [
    "model.layers.{d}.",
    "layers.{d}.",
    "transformer.h.{d}.",
    "backbone.layers.{d}.",
    "language_model.model.layers.{d}."
  ],
  "block": [
    {
      "op": "norm",
      "inputs": [
        {
          "tensor": "x"
        },
        {
          "tensor": "input_layernorm.weight"
        }
      ],
      "outputs": [
        "_t0"
      ],
      "eps": 1e-06,
      "name": "input_layernorm",
      "weight_offset": 1.0
    },
    {
      "op": "multihead_attention",
      "inputs": [
        {
          "tensor": "_t0"
        }
      ],
      "outputs": [
        "_t1"
      ],
      "qk_norm": true,
      "fused_qkv": false
    },
    {
      "op": "norm",
      "inputs": [
        {
          "tensor": "_t1"
        },
        {
          "tensor": "post_attention_layernorm.weight"
        }
      ],
      "outputs": [
        "_t2"
      ],
      "eps": 1e-06,
      "name": "post_attention_layernorm",
      "weight_offset": 1.0
    },
    {
      "op": "add",
      "inputs": [
        {
          "tensor": "x"
        },
        {
          "tensor": "_t2"
        }
      ],
      "outputs": [
        "_t3"
      ]
    },
    {
      "op": "norm",
      "inputs": [
        {
          "tensor": "_t3"
        },
        {
          "tensor": "pre_feedforward_layernorm.weight"
        }
      ],
      "outputs": [
        "_t4"
      ],
      "eps": 1e-06,
      "name": "pre_feedforward_layernorm",
      "weight_offset": 1.0
    },
    {
      "op": "mlp",
      "inputs": [
        {
          "tensor": "_t4"
        }
      ],
      "outputs": [
        "_t5"
      ],
      "activation": "gelu",
      "fused_gate_up": false
    },
    {
      "op": "norm",
      "inputs": [
        {
          "tensor": "_t5"
        },
        {
          "tensor": "post_feedforward_layernorm.weight"
        }
      ],
      "outputs": [
        "_t6"
      ],
      "eps": 1e-06,
      "name": "post_feedforward_layernorm",
      "weight_offset": 1.0
    },
    {
      "op": "add",
      "inputs": [
        {
          "tensor": "_t3"
        },
        {
          "tensor": "_t6"
        }
      ],
      "outputs": [
        "_t7"
      ]
    }
  ],
  "block_weights": [
    {
      "id": "input_layernorm.weight",
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "post_attention_layernorm.weight",
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "pre_feedforward_layernorm.weight",
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "post_feedforward_layernorm.weight",
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "self_attn.q_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "self_attn.k_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "self_attn.v_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "self_attn.o_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "self_attn.q_norm.weight",
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "self_attn.k_norm.weight",
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "mlp.gate_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "mlp.up_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "mlp.down_proj.weight",
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": true
    }
  ],
  "pre_block": [
    {
      "op": "embedding",
      "inputs": [
        {
          "tensor": "input_ids"
        }
      ],
      "outputs": [
        "_t0"
      ]
    },
    {
      "op": "mul",
      "inputs": [
        {
          "tensor": "_t0"
        },
        {
          "scalar": 45.254833995939045
        }
      ],
      "outputs": [
        "_t1"
      ]
    }
  ],
  "post_block": [
    {
      "op": "norm",
      "inputs": [
        {
          "tensor": "_t_last"
        }
      ],
      "outputs": [
        "_t_out"
      ],
      "eps": 1e-06
    }
  ],
  "global_weights": [
    {
      "id": "token_embeddings",
      "candidates": [
        "model.embed_tokens.weight",
        "embed_tokens.weight",
        "transformer.wte.weight",
        "backbone.embedding.weight",
        "language_model.model.embed_tokens.weight"
      ],
      "module_type": "Embedding",
      "layout": "embedding",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "ln_final",
      "candidates": [
        "model.norm.weight",
        "norm.weight",
        "transformer.ln_f.weight",
        "backbone.norm.weight",
        "language_model.model.norm.weight",
        "model.embedding_norm.weight"
      ],
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "lm_head",
      "candidates": [
        "lm_head.weight",
        "output.weight",
        "transformer.lm_head.weight",
        "language_model.lm_head.weight"
      ],
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": false
    }
  ]
}
