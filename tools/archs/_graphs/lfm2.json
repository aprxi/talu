{
  "name": "lfm2",
  "model_types": [
    "lfm2"
  ],
  "weight_prefixes": [
    "model.layers.{d}.",
    "layers.{d}.",
    "transformer.h.{d}.",
    "backbone.layers.{d}.",
    "language_model.model.layers.{d}."
  ],
  "block_variants": {
    "shortconv": {
      "ops": [
        {
          "op": "norm",
          "inputs": [
            {
              "tensor": "x"
            },
            {
              "tensor": "operator_norm.weight"
            }
          ],
          "outputs": [
            "_t0"
          ],
          "eps": 1e-05,
          "name": "operator_norm"
        },
        {
          "op": "shortconv",
          "inputs": [
            {
              "tensor": "_t0"
            }
          ],
          "outputs": [
            "_t1"
          ],
          "name": "conv",
          "d_conv": 3,
          "conv_dim": 1024,
          "conv_dim_out": 1024,
          "conv_bias": false
        },
        {
          "op": "add",
          "inputs": [
            {
              "tensor": "x"
            },
            {
              "tensor": "_t1"
            }
          ],
          "outputs": [
            "_t2"
          ]
        },
        {
          "op": "norm",
          "inputs": [
            {
              "tensor": "_t2"
            },
            {
              "tensor": "ffn_norm.weight"
            }
          ],
          "outputs": [
            "_t3"
          ],
          "eps": 1e-05,
          "name": "ffn_norm"
        },
        {
          "op": "mlp",
          "inputs": [
            {
              "tensor": "_t3"
            }
          ],
          "outputs": [
            "_t4"
          ],
          "activation": "silu",
          "fused_gate_up": false
        },
        {
          "op": "add",
          "inputs": [
            {
              "tensor": "_t2"
            },
            {
              "tensor": "_t4"
            }
          ],
          "outputs": [
            "_t5"
          ]
        }
      ],
      "weights": [
        {
          "id": "operator_norm.weight",
          "module_type": "RMSNorm",
          "layout": "none",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "conv.in_proj.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "conv.conv.weight",
          "module_type": "Conv1d",
          "layout": "conv1d_depthwise",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "conv.out_proj.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "ffn_norm.weight",
          "module_type": "RMSNorm",
          "layout": "none",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "feed_forward.w1.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "feed_forward.w2.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "feed_forward.w3.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        }
      ]
    },
    "attention": {
      "ops": [
        {
          "op": "norm",
          "inputs": [
            {
              "tensor": "x"
            },
            {
              "tensor": "operator_norm.weight"
            }
          ],
          "outputs": [
            "_t0"
          ],
          "eps": 1e-05,
          "name": "operator_norm"
        },
        {
          "op": "multihead_attention",
          "inputs": [
            {
              "tensor": "_t0"
            }
          ],
          "outputs": [
            "_t1"
          ],
          "qk_norm": true,
          "fused_qkv": false
        },
        {
          "op": "add",
          "inputs": [
            {
              "tensor": "x"
            },
            {
              "tensor": "_t1"
            }
          ],
          "outputs": [
            "_t2"
          ]
        },
        {
          "op": "norm",
          "inputs": [
            {
              "tensor": "_t2"
            },
            {
              "tensor": "ffn_norm.weight"
            }
          ],
          "outputs": [
            "_t3"
          ],
          "eps": 1e-05,
          "name": "ffn_norm"
        },
        {
          "op": "mlp",
          "inputs": [
            {
              "tensor": "_t3"
            }
          ],
          "outputs": [
            "_t4"
          ],
          "activation": "silu",
          "fused_gate_up": false
        },
        {
          "op": "add",
          "inputs": [
            {
              "tensor": "_t2"
            },
            {
              "tensor": "_t4"
            }
          ],
          "outputs": [
            "_t5"
          ]
        }
      ],
      "weights": [
        {
          "id": "operator_norm.weight",
          "module_type": "RMSNorm",
          "layout": "none",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "self_attn.q_proj.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "self_attn.k_proj.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "self_attn.v_proj.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "self_attn.out_proj.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "self_attn.q_layernorm.weight",
          "module_type": "RMSNorm",
          "layout": "none",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "self_attn.k_layernorm.weight",
          "module_type": "RMSNorm",
          "layout": "none",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "ffn_norm.weight",
          "module_type": "RMSNorm",
          "layout": "none",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "feed_forward.w1.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "feed_forward.w2.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        },
        {
          "id": "feed_forward.w3.weight",
          "module_type": "Linear",
          "layout": "linear",
          "dtype": "float32",
          "required": true
        }
      ]
    }
  },
  "variant_names": [
    "shortconv",
    "attention"
  ],
  "variant_aliases": {
    "conv": "shortconv",
    "full_attention": "attention"
  },
  "layer_map": [
    0,
    0,
    1,
    0,
    0,
    1,
    0,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0
  ],
  "pre_block": [
    {
      "op": "embedding",
      "inputs": [
        {
          "tensor": "input_ids"
        }
      ],
      "outputs": [
        "_t0"
      ]
    }
  ],
  "post_block": [
    {
      "op": "norm",
      "inputs": [
        {
          "tensor": "_t_last"
        }
      ],
      "outputs": [
        "_t_out"
      ],
      "eps": 1e-05
    }
  ],
  "global_weights": [
    {
      "id": "token_embeddings",
      "candidates": [
        "model.embed_tokens.weight",
        "embed_tokens.weight",
        "transformer.wte.weight",
        "backbone.embedding.weight",
        "language_model.model.embed_tokens.weight"
      ],
      "module_type": "Embedding",
      "layout": "embedding",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "ln_final",
      "candidates": [
        "model.norm.weight",
        "norm.weight",
        "transformer.ln_f.weight",
        "backbone.norm.weight",
        "language_model.model.norm.weight",
        "model.embedding_norm.weight"
      ],
      "module_type": "RMSNorm",
      "layout": "none",
      "dtype": "float32",
      "required": true
    },
    {
      "id": "lm_head",
      "candidates": [
        "lm_head.weight",
        "output.weight",
        "transformer.lm_head.weight",
        "language_model.lm_head.weight"
      ],
      "module_type": "Linear",
      "layout": "linear",
      "dtype": "float32",
      "required": false
    }
  ]
}
